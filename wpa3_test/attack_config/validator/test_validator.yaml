$schema: http://json-schema.org/draft-07/schema#
title: Test Configuration Schema
type: object
required:
  - name
  - attacker_module
  - actors
  - attack_config
ignore_interfaces:
  type: array
  items:
    type: string
  minItems: 1
  description: ignore interfaces (to ignore interface where is notebook connected to internet)
properties:
  extends:
    type: string
    description: Path to the parent YAML template
  name:
    type: string
    description: Test name

#  wizard_fallback:
#    type: boolean
#    description: If should be wizard asked after selection error

  attacker_module:
    type: string
    description: Name of attacker_module

  actors:
    type: object
    description: Test actors definitions
    minProperties: 1  # At least one actor must be defined
    additionalProperties:
      $ref: '#/definitions/Actor'

  attack_config:
    type: object
    description: test/attack parameters
    required:
      - validator
    properties:
      validator:
        type: string
        description: validator

definitions:
  Actor: # Actor
    type: object
    additionalProperties: false
    required:
      - type
      - source
    properties:
      type:
        type: string
        enum: ["AP", "STA", "process"]
        description: Access point
      source:
        type: string
        enum: ["simulation","internal", "external"]
        description: mac_hwsim, internal, external
      scan_iface:
        type: string
        description: Interface to scan when source is external
      netns:
        type: string
        description: Namespace to isolate AP/STA for iperf3 etc. observation
      ip_addr:
        type: string
        # Regex pro IPv4 (0.0.0.0 a≈æ 255.255.255.255)
        pattern: '^((25[0-5]|(2[0-4]|1\d|[1-9]|)\d)\.?\b){4}$'
        description: Static IP address for the actor (e.g., 192.168.1.1)
      channel:
        type: integer
      setup:
        type: object
        additionalProperties: false
        properties:
          channel:
            type: integer
          program:
            type: string
            enum: [ "hostapd", "wpa_supplicant", "iperf3" ]
          program_config:
            type: object
            additionalProperties: true
      selection:
        type: object
        additionalProperties: false
        properties:
          mac:
            type: string
            pattern: '^[0-9A-Fa-f]{2}(:[0-9A-Fa-f]{2}){5}$'
            description: MAC address in format AA:BB:CC:DD:EE:FF
          essid:
            type: string
            description: Name of AP
          iface:
            type: string
            description: Name of interface
          driver:
            type: string
            description: driver of wifi card
          condition:
            type: array
            items:
              type: string
              enum: ["AP", "monitor", "2_4GHz", "5Gz", "WPA-PSK", "WPA3-SAE"]
            minItems: 1
            description: Condition for selection

        minProperties: 1

    allOf:
      - if:
          properties:
            source:
              const: "external"
        then:
          required:
            - scan_iface
