$schema: http://json-schema.org/draft-07/schema#
title: Test Configuration Schema
type: object
required:
  - name
  - attacker_module
  - actors
  - attack_config
ignore_interfaces:
  type: array
  items:
    type: string
  minItems: 1
  description: ignore interfaces (to ignore interface where is notebook connected to internet)
properties:
  name:
    type: string
    description: Test name

#  wizard_fallback:
#    type: boolean
#    description: If should be wizard asked after selection error

  attacker_module:
    type: string
    description: Name of attacker_module

  actors:
    type: object
    description: Test actors definitions
    minProperties: 1  # At least one actor must be defined
    additionalProperties:
      $ref: '#/definitions/Actor'

  attack_config:
    type: object
    description: test/attack parameters
    required:
      - validator
    properties:
      validator:
        type: string
        description: validator

definitions:
  Actor: # Actor
    type: object
    required:
      - type
      - source
    properties:
      type:
        type: string
        enum: ["AP", "STA", "process"]
        description: Access point
      source:
        type: string
        enum: ["simulation","internal", "external"]
        description: mac_hwsim, internal, external
      scan_iface:
        type: string
        description: Interface to scan when source is external
      netns:
        type: string
        description: Namespace to isolate AP/STA for iperf3 etc. observation
      selection:
        type: object
        properties:
          mac:
            type: string
            pattern: '^[0-9A-Fa-f]{2}(:[0-9A-Fa-f]{2}){5}$'
            description: MAC address in format AA:BB:CC:DD:EE:FF
          essid:
            type: string
            description: Name of AP
          iface:
            type: string
            description: Name of interface
          driver:
            type: string
            description: driver of wifi card
          condition:
            type: array
            items:
              type: string
              enum: ["AP", "monitor", "2_4GHz", "5Gz", "WPA-PSK", "WPA3-SAE"]
            minItems: 1
            description: Condition for selection
        minProperties: 1
      additionalProperties: false

    allOf:
      - if:
          properties:
            source:
              const: "external"
        then:
          required:
            - scan_iface
