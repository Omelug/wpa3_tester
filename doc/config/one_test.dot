digraph {
    //rankdir=LR;
    node [fontname="DejaVu Sans"];

    { // processes
        node [
            shape=rectangle,
            style=filled,
            fillcolor="#EEEEFF",
            color="#333366",
            label="⚙ settings",
        ];
        config_validation[label="⚙ config validation"];
        req_validation[label="⚙ requirement validation"];
        start_processes[label="⚙ setup process"];
        wait_for_setup[label="⚙ wait for setup (check process outputs)"];
        run_tests[label="⚙ run tests"];
        wait_for_all_process_end[label="⚙ wait for all process end"];
    }
    { // errors
        node [
            shape=rectangle,
            style=filled,
            fillcolor="#c96666",
            label="error",
        ];
        var_not_found_error[label="templeate error"];
        parser_error[label="config parser errors"];
        req_gather_error[label="req gathering errors"];
        req_val_error[label="req validation errors"];
        start_process_error[label="start process errors"];
        wait_process_error[label="wait errors"];
    }
    { // files
        node [
            shape=rectangle,
            style=filled,
            fillcolor="#9b9898",
            label="file",
        ];
        creds[label="creds file"];
        configfile[label="config file"];
        templeates[label="templeate .yaml.in"];

    }

    // start
    wpa_tester[
        shape=rectangle,
        color="#33aa33",
        style=filled,
        fillcolor="#eeffee",
        label="wpa_tester"
    ];

    wpa_tester -> configfile [label="--config"];
    wpa_tester -> test_map[label="--test"];
    test_map -> configfile [label="load test config"];

    configfile -> templeates [label="templeate set"];
    templeates -> var_not_found_error;
    templeates -> configfile [label="generate"];

    configfile -> config_validation [label="validate"];
    config_validation -> parser_error;


    config_validation ->config_requirement;
    creds ->config_requirement;

    SW_scan_or_build[label="SW scan or build"];
    external_scan ->config_requirement;
    interfaces_scan ->config_requirement;
    SW_scan_or_build ->config_requirement;
    config_requirement -> req_gather_error;

    config_requirement -> req_validation;
    req_validation -> req_val_error;

    req_validation->start_processes;
    start_processes -> start_process_error;

     { // example processes
        node [
            style=filled,
            fillcolor="#3ae0cd",
            label="file",
        ];
        example_process_1[label="process 1, (internal)"];
        example_process_2[label="process 2 (external)"];
    }
    start_processes -> example_process_1[label="setup function"];
    start_processes -> example_process_2 [label="run external program"];

    example_process_1 -> log;

    { //log
        node [
            style=filled,
            fillcolor="#6ea4d3",
            label="log",
        ];
        log[label="logger from all processes"];
    }
    legger_rewriter->log;
    example_process_2 -> log;
    log -> wait_process_error;
    log -> wait_for_setup;


    wait_for_setup -> run_tests[label="run tests"];
    run_tests -> example_process_1 [label ="run function"];
    run_tests ->wait_for_all_process_end[label="wait for all process end"];
    wait_for_all_process_end -> end_of_test[label="wait for all proceses end (from internal return or log)"];
    end_of_test[
        shape=rectangle,
        color="#33aa33",
        style=filled,
        fillcolor="#eeffee",
        label="end of test"
    ];
    end_of_test -> statistics[label="generate"];
    log -> statistics;
}
